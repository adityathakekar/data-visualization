<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starbucks Grande Latte Index 2025</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            font-family: 'Roboto', sans-serif;
            color: #e0e0e0;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .section-container {
            width: 1400px;
            position: relative;
        }

        /* --- Typography --- */
        h1 {
            font-weight: 900;
            font-size: 48px;
            margin: 0;
            line-height: 1.1;
            color: #ffffff;
        }

        h1 span {
            color: #ff9800; 
        }

        .subtitle {
            font-size: 16px;
            color: #b0b0b0;
            margin-top: 5px;
            max-width: 800px;
            line-height: 1.4;
        }
        
        .subtitle strong {
            color: #ff9800;
        }

        /* --- Map Specifics --- */
        #map-container {
            height: 900px;
            position: relative;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header-box {
            position: absolute;
            top: 40px;
            left: 50px;
            z-index: 10;
            pointer-events: none;
        }

        .footer-box {
            position: absolute;
            bottom: 30px;
            left: 50px;
            z-index: 10;
            pointer-events: auto;
        }
        
        a.source-link {
            color: #777;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.2s;
        }
        a.source-link:hover {
            color: #ff9800;
            text-decoration: underline;
        }

        /* --- D3 Map Elements --- */
        .country {
            stroke: #2c2c2c;
            stroke-width: 0.5px;
            transition: fill 0.3s, opacity 0.3s;
        }
        .country:hover {
            opacity: 0.8;
            stroke: #555;
        }
        .connector {
            stroke: #777;
            stroke-width: 1px;
            fill: none;
            opacity: 0.7;
        }
        .label-box-bg {
            fill: rgba(30, 30, 30, 0.95);
            stroke: #ff9800;
            stroke-width: 1px;
        }
        .label-country {
            font-size: 11px;
            fill: #bbb;
            font-weight: 500;
            text-anchor: middle;
        }
        .label-price {
            font-size: 15px;
            fill: #fff;
            font-weight: 900;
            text-anchor: middle;
        }
        
        /* Legend */
        .legend-text { font-size: 10px; fill: #aaa; text-anchor: middle; }
        .legend-title { font-size: 12px; font-weight: bold; fill: #ddd; }

    </style>
</head>
<body>

<div class="section-container">
    <div id="map-container">
        <div class="header-box">
            <svg width="50" height="70" viewBox="0 0 100 120" style="float:left; margin-right: 15px;">
                <path d="M20 10 L80 10 L70 90 C70 100 60 105 50 105 C40 105 30 100 30 90 Z" fill="#222" stroke="#ff9800" stroke-width="4"/>
                <circle cx="50" cy="55" r="18" fill="#ff9800"/>
                <path d="M45 45 L55 45 M50 35 L50 65" stroke="#222" stroke-width="2"/> 
                <rect x="20" y="5" width="60" height="5" fill="#8d6e63"/>
            </svg>
            <h1 style="font-size: 42px;">The Price of a <br><span>Grande Latte</span></h1>
            <div class="subtitle">Global price comparison of <strong> a Grande (16oz)</strong> <br>Starbucks Latte (2025).</br></div>
        </div>

        <div class="footer-box">
            <div class="subtitle">
                <strong>Switzerland ($8.15)</strong> remains the most expensive market.<br>
                <strong>USA ($5.74)</strong> is now the global baseline for premium pricing.<br><br>
                <a href="https://www.visualcapitalist.com/infographic-the-opportunity-cost-of-a-daily-starbucks-latte/" target="_blank" class="source-link">
                    Source: Visual Capitalist (2024/25) & Economist Latte Index Data ->
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // DATASET (Verified FY 2025 - GRANDE SIZE)
    // ==========================================
    
    // Prices extrapolated for "Grande" (approx +15% over standard Tall Index) or sourced directly.
    const mapData = [
        { country: "Switzerland", price: 8.15, code: "CHE" }, // Zurich (~7.17 Tall -> ~8.15 Grande)
        { country: "Denmark", price: 7.50, code: "DNK" },     // Copenhagen
        { country: "Luxembourg", price: 6.95, code: "LUX" },
        { country: "USA", price: 5.74, code: "USA" },         // Source: Visual Capitalist 2025 Report (Direct)
        { country: "China", price: 4.80, code: "CHN" },       // Shanghai (~34 RMB)
        { country: "UK", price: 5.35, code: "GBR" },          // London (~£4.25-£4.50)
        { country: "Japan", price: 4.10, code: "JPN" },       // Tokyo
        { country: "South Korea", price: 4.50, code: "KOR" }, 
        { country: "Canada", price: 4.45, code: "CAN" },
        { country: "Germany", price: 5.85, code: "DEU" },
        { country: "France", price: 6.15, code: "FRA" },
        { country: "Australia", price: 4.90, code: "AUS" },
        { country: "Brazil", price: 2.25, code: "BRA" },
        { country: "Turkey", price: 1.55, code: "TUR" },      // Lira devaluation impact
        { country: "India", price: 4.10, code: "IND" },
        { country: "Mexico", price: 4.60, code: "MEX" },
        { country: "Saudi Arabia", price: 5.80, code: "SAU" },
        { country: "Egypt", price: 2.45, code: "EGY" },
        { country: "Italy", price: 4.20, code: "ITA" },       
        { country: "Spain", price: 4.60, code: "ESP" },
        { country: "Indonesia", price: 3.55, code: "IDN" },
        { country: "Vietnam", price: 3.30, code: "VNM" },
        { country: "Thailand", price: 3.95, code: "THA" }
    ];

    // ==========================================
    // MAP VISUALIZATION LOGIC (D3.js)
    // ==========================================
    
    const mapWidth = 1400;
    const mapHeight = 900;
    
    const svgMap = d3.select("#map-container")
        .append("svg")
        .attr("width", mapWidth)
        .attr("height", mapHeight);

    const dataMap = new Map(mapData.map(d => [d.code, d]));

    // Color Scale: Adjusted for higher Grande prices
    const colorScale = d3.scaleThreshold()
        .domain([2.5, 4.0, 5.0, 6.0, 7.0])
        .range(["#fdd835", "#ffb300", "#fb8c00", "#e65100", "#b71c1c", "#5f0000"]);

    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then(function(topo) {

        const projection = d3.geoMercator()
            .scale(150)
            .center([0, 40])
            .translate([mapWidth / 2, mapHeight / 2]);

        const path = d3.geoPath().projection(projection);

        // Draw Map
        svgMap.append("g")
            .selectAll("path")
            .data(topo.features)
            .join("path")
            .attr("d", path)
            .attr("class", "country")
            .attr("fill", function (d) {
                const countryData = dataMap.get(d.id); 
                return countryData ? colorScale(countryData.price) : "#2c2c2c";
            });

        // Force Layout for Labels
        let featuresWithData = topo.features.filter(d => dataMap.has(d.id));
        
        featuresWithData.forEach(d => {
            const info = dataMap.get(d.id);
            const centroid = path.centroid(d);
            d.ox = isNaN(centroid[0]) ? mapWidth/2 : centroid[0];
            d.oy = isNaN(centroid[1]) ? mapHeight/2 : centroid[1];
            d.x = d.ox; 
            d.y = d.oy;
            d.info = info;

            // Measure Label
            const tempText = svgMap.append("text")
                .attr("class", "label-price")
                .text("$" + info.price.toFixed(2))
                .style("opacity", 0);
            const bbox = tempText.node().getBBox();
            d.width = bbox.width + 35;
            d.height = bbox.height + 25;
            tempText.remove();
        });

        const simulation = d3.forceSimulation(featuresWithData)
            .force("x", d3.forceX(d => d.ox).strength(0.1))
            .force("y", d3.forceY(d => d.oy).strength(0.1))
            .force("collide", d3.forceCollide(d => Math.max(d.width, d.height) / 1.5).strength(1))
            .stop();

        for (let i = 0; i < 150; ++i) simulation.tick();

        // Draw Labels
        const labelsLayer = svgMap.append("g");
        const labelGroups = labelsLayer.selectAll(".label-group")
            .data(featuresWithData)
            .join("g");

        // Connector
        labelGroups.append("line")
            .attr("class", "connector")
            .attr("x1", d => d.ox).attr("y1", d => d.oy)
            .attr("x2", d => d.x).attr("y2", d => d.y);

        // Dot
        labelGroups.append("circle")
            .attr("cx", d => d.ox).attr("cy", d => d.oy)
            .attr("r", 3).attr("fill", "#ff9800");

        // Label Box
        const labelContainer = labelGroups.append("g")
            .attr("transform", d => `translate(${d.x}, ${d.y})`);

        labelContainer.append("rect")
            .attr("class", "label-box-bg")
            .attr("x", d => -d.width / 2).attr("y", d => -d.height / 1.5)
            .attr("width", d => d.width).attr("height", d => d.height)
            .attr("rx", 6);

        labelContainer.append("text")
            .attr("class", "label-country")
            .attr("y", d => -d.height / 3.5)
            .text(d => d.info.country);

        labelContainer.append("text")
            .attr("class", "label-price")
            .attr("y", d => d.height / 6)
            .text(d => "$" + d.info.price.toFixed(2));

        // Legend
        const legend = svgMap.append("g").attr("transform", "translate(1000, 50)");
        legend.append("text").attr("class", "legend-title").attr("x", 0).attr("y", -10).text("Grande Latte ($)");
        
        const defs = svgMap.append("defs");
        const linearGradient = defs.append("linearGradient").attr("id", "gradient");
        const colors = colorScale.range();
        
        linearGradient.selectAll("stop").data(colors).enter().append("stop")
            .attr("offset", (d, i) => `${(i / (colors.length - 1)) * 100}%`)
            .attr("stop-color", d => d);

        legend.append("rect").attr("width", 300).attr("height", 10).style("fill", "url(#gradient)");
        
        const legendLabels = [2.5, 4, 5, 6, 7];
        legend.selectAll("text.axis").data(legendLabels).enter().append("text")
            .attr("class", "legend-text")
            .attr("x", (d, i) => (i / (legendLabels.length - 1)) * 300)
            .attr("y", 25).text(d => "$" + d);

    }).catch(err => console.error(err));

</script>

</body>
</html>
